<?jelly escape='true'?>
<j:jelly xmlns:j="jelly:core" xmlns:st="jelly:stapler" xmlns:f="/lib/form">

    <f:entry title="Name" field="name">
        <f:textbox/>
    </f:entry>

    <f:entry title="Docker Image" field="image"
             description="Docker image for the agent (e.g., jenkins/inbound-agent:latest)">
        <f:textbox default="jenkins/inbound-agent:latest"/>
    </f:entry>

    <f:entry title="Label" field="label"
             description="Space-separated list of labels for this agent template">
        <f:textbox/>
    </f:entry>

    <f:entry title="Usage Mode" field="mode">
        <f:enum>${it.description}</f:enum>
    </f:entry>

    <f:entry title="Working Dir" field="workingDir"
             description="Agent working directory inside the container">
        <f:textbox default="/home/jenkins/agent"/>
    </f:entry>

    <f:entry title="Number of Executors" field="numExecutors">
        <f:number default="1" min="1" max="10"/>
    </f:entry>

    <f:entry title="Max Instances" field="maxInstances"
             description="Maximum number of containers from this template">
        <f:number default="5" min="1" max="100"/>
    </f:entry>

    <f:entry title="Command" field="command"
             description="Override container command (optional)">
        <f:textbox/>
    </f:entry>

    <f:entry title="Inherit From" field="inheritFrom"
             description="Name of parent template to inherit settings from (like K8s podTemplate)">
        <f:textbox/>
    </f:entry>

    <f:entry title="User" field="user"
             description="User to run container as (e.g., root, 1000:1000)">
        <f:textbox/>
    </f:entry>

    <f:section title="Environment Variables">
        <f:entry title="Environment Variables">
            <f:repeatableProperty field="envVars" add="Add Variable"/>
        </f:entry>
    </f:section>

    <f:section title="Host Binds">
        <f:entry title="Host Binds">
            <f:repeatableProperty field="hostBinds" add="Add Bind"/>
        </f:entry>
    </f:section>

    <f:section title="Docker Configs">
        <f:entry title="Configs (newline-separated)" field="configsString"
                 description="Docker Swarm configs to mount. Format: configName:targetPath (one per line). Example: nethasp.ini:/opt/1cv8/current/conf/nethasp.ini">
            <f:textarea/>
        </f:entry>
    </f:section>

    <f:section title="Cache Directories">
        <f:entry title="Cache Dirs (newline-separated)" field="cacheDirsString"
                 description="Directories to mount as tmpfs for caching (one per line). Example: /cache">
            <f:textarea/>
        </f:entry>
    </f:section>

    <f:section title="Port Bindings">
        <f:entry title="Port Binds (newline-separated)" field="portBinds"
                 description="Published ports. Format: [hostPort:]containerPort[/protocol]. Examples: 80:8080, :5900">
            <f:textarea/>
        </f:entry>
    </f:section>

    <f:advanced>
        <f:section title="Resource Constraints">
            <f:entry title="CPU Limit" field="cpuLimit"
                     description="CPU limit (e.g., 2.0 for 2 CPUs)">
                <f:textbox/>
            </f:entry>

            <f:entry title="Memory Limit" field="memoryLimit"
                     description="Memory limit (e.g., 4g, 512m)">
                <f:textbox/>
            </f:entry>

            <f:entry title="CPU Reservation" field="cpuReservation"
                     description="CPU reservation (guaranteed)">
                <f:textbox/>
            </f:entry>

            <f:entry title="Memory Reservation" field="memoryReservation"
                     description="Memory reservation (guaranteed)">
                <f:textbox/>
            </f:entry>

            <f:entry title="Generic Resources (GPU)" field="genericResourcesString"
                     description="GPU and other resources (comma-separated, e.g., NVIDIA-GPU=1, FPGA=2)">
                <f:textbox/>
            </f:entry>
        </f:section>

        <f:section title="Security Profiles">
            <f:entry title="Seccomp Profile" field="seccompProfile"
                     description="Seccomp profile: 'default', 'unconfined', or path to custom profile">
                <f:textbox/>
            </f:entry>

            <f:entry title="AppArmor Profile" field="apparmorProfile"
                     description="AppArmor profile: 'runtime/default', 'unconfined', or custom profile name">
                <f:textbox/>
            </f:entry>
        </f:section>

        <f:section title="Timeouts and Retry">
            <f:entry title="Connection Timeout (seconds)" field="connectionTimeoutSeconds"
                     description="Max time to wait for agent to connect">
                <f:number default="300" min="30" max="3600"/>
            </f:entry>

            <f:entry title="Idle Timeout (minutes)" field="idleTimeoutMinutes"
                     description="Idle time before agent termination">
                <f:number default="30" min="1" max="1440"/>
            </f:entry>

            <f:entry title="Provision Retry Count" field="provisionRetryCount"
                     description="Number of retries on provisioning failure">
                <f:number default="3" min="0" max="10"/>
            </f:entry>

            <f:entry title="Retry Delay (ms)" field="provisionRetryDelayMs"
                     description="Initial delay between retries (with exponential backoff)">
                <f:number default="1000" min="100" max="60000"/>
            </f:entry>
        </f:section>

        <f:section title="Health Check">
            <f:entry title="Health Check Command" field="healthCheckCommand"
                     description="Command to check container health (e.g., curl -f http://localhost/ || exit 1)">
                <f:textbox/>
            </f:entry>

            <f:entry title="Interval (seconds)" field="healthCheckIntervalSeconds"
                     description="Time between health checks">
                <f:number default="30" min="5" max="300"/>
            </f:entry>

            <f:entry title="Timeout (seconds)" field="healthCheckTimeoutSeconds"
                     description="Time to wait for health check response">
                <f:number default="10" min="1" max="60"/>
            </f:entry>

            <f:entry title="Retries" field="healthCheckRetries"
                     description="Number of consecutive failures before unhealthy">
                <f:number default="3" min="1" max="10"/>
            </f:entry>
        </f:section>

        <f:section title="Docker Secrets">
            <f:entry title="Secrets">
                <f:repeatableProperty field="secrets" add="Add Secret"/>
            </f:entry>
        </f:section>

        <f:section title="Placement">
            <f:entry title="Placement Constraints (newline-separated)" field="placementConstraintsString"
                     description="One constraint per line (e.g., node.role==worker)">
                <f:textarea/>
            </f:entry>

            <f:entry title="Network Aliases" field="networkAliasesString"
                     description="Comma-separated network aliases">
                <f:textbox/>
            </f:entry>
        </f:section>

        <f:section title="Advanced Container Options">
            <f:entry title="Privileged Mode" field="privileged"
                     description="Run container in privileged mode (use with caution)">
                <f:checkbox/>
            </f:entry>

            <f:entry title="Hostname" field="hostname"
                     description="Container hostname">
                <f:textbox/>
            </f:entry>

            <f:entry title="Add Capabilities" field="capAddString"
                     description="Linux capabilities to add (comma-separated, e.g., CAP_NET_ADMIN, CAP_SYS_PTRACE)">
                <f:textbox/>
            </f:entry>

            <f:entry title="Drop Capabilities" field="capDropString"
                     description="Linux capabilities to drop (comma-separated)">
                <f:textbox/>
            </f:entry>

            <f:entry title="Sysctls (newline-separated)" field="sysctlsString"
                     description="Kernel parameters, one per line (e.g., net.core.somaxconn=1024)">
                <f:textarea/>
            </f:entry>

            <f:entry title="DNS IPs" field="dnsIps"
                     description="Custom DNS servers (comma-separated IP addresses)">
                <f:textbox/>
            </f:entry>

            <f:entry title="Stop Signal" field="stopSignal"
                     description="Signal to stop container (e.g., SIGTERM, SIGKILL)">
                <f:textbox/>
            </f:entry>

            <f:entry title="Stop Grace Period (seconds)" field="stopGracePeriod"
                     description="Grace period before force killing container">
                <f:number default="10" min="0" max="300"/>
            </f:entry>
        </f:section>
    </f:advanced>

</j:jelly>
