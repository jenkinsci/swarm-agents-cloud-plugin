jenkins:
  clouds:
    - swarmAgentsCloud:
        name: "production-swarm"
        dockerHost: "tcp://swarm-manager.prod.local:2376"
        credentialsId: "docker-tls-creds"
        jenkinsUrl: "https://jenkins.prod.local"
        swarmNetwork: "jenkins-agents-network"
        maxConcurrentAgents: 50
        templates:
          - name: "maven-jdk21"
            image: "myregistry/jenkins-agent-maven:jdk21"
            label: "maven java21 linux"
            workingDir: "/home/jenkins/agent"
            numExecutors: 2
            maxInstances: 10
            mode: EXCLUSIVE
            cpuLimit: "2.0"
            memoryLimit: "4g"
            cpuReservation: "0.5"
            memoryReservation: "1g"
            hostBinds:
              - type: BIND
                source: "/var/cache/maven"
                target: "/root/.m2/repository"
                readOnly: false
              - type: VOLUME
                source: "jenkins-workspace"
                target: "/workspace"
            envVars:
              - name: "MAVEN_OPTS"
                value: "-Xmx2g -XX:+UseG1GC"
              - name: "JAVA_HOME"
                value: "/opt/java/openjdk"
            placementConstraints:
              - "node.role==worker"
              - "node.labels.type==build"
            networkAliases:
              - "maven-agent"
              - "build-agent"
            configs:
              - configName: "maven-settings"
                targetPath: "/root/.m2/settings.xml"
            cacheDirs:
              - "/root/.m2/repository"
              - "/tmp/build-cache"
            extraHosts:
              - "internal-registry:192.168.1.100"
              - "database.local:10.0.0.50"

          - name: "nodejs-agent"
            image: "myregistry/jenkins-agent-node:20"
            label: "nodejs node npm"
            workingDir: "/home/jenkins/agent"
            numExecutors: 4
            maxInstances: 15
            cpuLimit: "1.0"
            memoryLimit: "2g"
            envVars:
              - name: "NODE_OPTIONS"
                value: "--max-old-space-size=1536"

          - name: "docker-builder"
            image: "myregistry/jenkins-agent-dind:latest"
            label: "docker build dind"
            workingDir: "/home/jenkins/agent"
            numExecutors: 1
            maxInstances: 5
            mode: EXCLUSIVE
            cpuLimit: "4.0"
            memoryLimit: "8g"
            hostBinds:
              - type: BIND
                source: "/var/run/docker.sock"
                target: "/var/run/docker.sock"
                readOnly: false
            placementConstraints:
              - "node.labels.dind==enabled"
